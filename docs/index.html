<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MARKI Secure — Demo Front</title>
  <link rel="stylesheet" href="styles.css">
  <!-- QR генератор та сканер -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
</head>
<body>
  <div class="app">
    <header class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <div class="name">
          <h1>MARKI Secure</h1>
          <p>Антифейк на NFT (Demo)</p>
        </div>
      </div>
      <nav class="tabs">
        <button class="tab active" data-tab="manufacturer">Виробник</button>
        <button class="tab" data-tab="user">Користувач</button>
      </nav>
    </header>

    <main class="container">
      <!-- Manufacturer -->
      <section id="manufacturer" class="tabpane active">
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <h2>Реєстрація продукту</h2>
            </div>
            <form id="createForm" class="form">
              <div class="field">
                <label>Серійний номер*</label>
                <input name="serial" placeholder="MILK-2025-000001" required />
              </div>
              <div class="field">
                <label>Назва*</label>
                <input name="name" placeholder="Organic Milk 1L" required />
              </div>
              <div class="row">
                <div class="field">
                  <label>Дата виробництва</label>
                  <input name="date" type="date" />
                </div>
                <div class="field">
                  <label>URL зображення (необов'язково)</label>
                  <input name="image" placeholder="" />
                </div>
              </div>
              <div class="field">
                <label>Сертифікати (через кому)</label>
                <input name="certificates" placeholder="ISO22000, HACCP" />
              </div>

              <div class="actions">
                <button class="btn primary">Створити (QR без URL)</button>
                <button type="reset" class="btn ghost">Очистити</button>
              </div>
            </form>

            <div id="createdBlock" class="created hidden">
              <h3>Створено</h3>
              <div class="created-body">
                <div class="qrbox">
                  <div id="labelQR"></div>
                  <span>JSON QR (службовий)</span>
                </div>
                <div class="qrbox">
                  <div id="publicQR"></div>
                  <span>Public URL QR (для покупця)</span>
                </div>
                <div class="meta">
                  <div><b>TokenId:</b> <span id="createdId"></span></div>
                  <div><b>Стан:</b> <span class="badge" id="createdState"></span></div>
                  <div class="mono"><b>IPFS (mock):</b> <span id="createdIpfs"></span></div>
                  <div class="mono"><b>Публічне посилання:</b> <span id="createdUrl"></span></div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Чек-токен (Claim)</h2>
            </div>
            <div class="row">
              <select id="productSelect" class="select">
                <option value="">— Оберіть продукт —</option>
              </select>
              <button id="issueBtn" class="btn success" disabled>Згенерувати</button>
            </div>

            <div id="ticketBlock" class="created hidden">
              <div class="created-body">
                <div class="qrbox">
                  <div id="ticketQR"></div>
                  <span>Claim QR</span>
                </div>
                <div class="meta">
                  <div><b>TicketId:</b> <span id="ticketId"></span></div>
                  <div><b>TokenId:</b> <span id="ticketToken"></span></div>
                  <div><b>Expires:</b> <span id="ticketExp"></span></div>
                  <details>
                    <summary>Показати payload</summary>
                    <pre id="ticketPayload" class="mono"></pre>
                  </details>
                </div>
              </div>
            </div>

            <div class="tablewrap">
              <h3>Список продуктів</h3>
              <table class="table" id="productsTable">
                <thead>
                  <tr>
                    <th>TokenId</th>
                    <th>Назва</th>
                    <th>Серійний</th>
                    <th>Стан</th>
                    <th>Дії</th>
                  </tr>
                </thead>
                <tbody id="productsBody">
                  <tr><td colspan="5" class="muted">Ще немає продуктів</td></tr>
                </tbody>
              </table>
            </div>

          </div>
        </div>
      </section>

      <!-- User -->
      <section id="user" class="tabpane">
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <h2>Перевірка / Сканування</h2>
            </div>
            <div class="row">
              <button id="openCam" class="btn primary">Відкрити камеру</button>
              <button id="stopCam" class="btn ghost" disabled>Зупинити</button>
            </div>
            <div id="reader" class="reader"></div>

            <div class="field">
              <label>Або вставте JSON payload QR</label>
              <textarea id="payloadText" rows="5" placeholder='{"t":"prod","id":...}'></textarea>
            </div>
            <button id="checkBtn" class="btn success">Перевірити</button>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>Результат</h2>
            </div>
            <div id="resultBox" class="result muted">Скануйте або вставте payload…</div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">© 2025 MARKI Secure (Demo). Backend: same origin</footer>
  </div>

  <script src="app.js"></script>
</body>
</html>
